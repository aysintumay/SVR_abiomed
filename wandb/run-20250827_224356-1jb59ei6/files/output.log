Starting trial 26 with gamma1=0.2, gamma2=0.7, gamma3=1.0
cuda:6
In env continuous
<module 'config' from '/home/ubuntu/noisy_mujoco/abiomed_env/config.py'>
time series transformer device cuda:6
Using device: cuda:6
/home/ubuntu/miniconda3/envs/mopo/lib/python3.8/site-packages/torch/nn/modules/transformer.py:307: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.self_attn.batch_first was not True(use batch_first for better inference performance)
  warnings.warn(f"enable_nested_tensor is True, but self.use_nested_tensor is False because {why_not_sparsity_fast_path}")
/home/ubuntu/noisy_mujoco/abiomed_env/model.py:402: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  state_dict = torch.load(path, map_location=self.device)
Model loaded from /abiomed/downsampled/models/10min_1hr_all_data_model.pth
loaded datasets with length
 train:  12051
 val:  1938
 test:  3876
Data loaded from /abiomed/downsampled/10min_1hr_all_data.pkl
Continuous action space. Min action: -2.2312597235306466, Max action: 1.8085589693336617
No validation data for Abiomed dataset
0.2 0.7 1.0
torch.Size([17865, 6, 12]) torch.Size([17865, 6]) torch.Size([17865, 66])
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 17865/17865 [00:08<00:00, 2123.91it/s]
-4.428163142542622 165.93485669748776
-2.736237 1.3035817
-5.897560220908415 83.67061508289387
-3.4000000000000004 3.0392697494459258
1.0 1.0
/home/ubuntu/SVR/SVR_old/main.py:94: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  behav.load_state_dict(torch.load(bc_model_path))
<module 'config' from '/home/ubuntu/noisy_mujoco/abiomed_env/config.py'>
time series transformer device cuda:6
Using device: cuda:6
Model loaded from /abiomed/downsampled/models/10min_1hr_all_data_model.pth
loaded datasets with length
 train:  12051
 val:  1938
 test:  3876
Data loaded from /abiomed/downsampled/10min_1hr_all_data.pkl
Continuous action space. Min action: -2.2312597235306466, Max action: 1.8085589693336617
EVAL ENVIRONMENT GAMMAS SET TO 0
 15%|███████████████████▎                                                                                                             | 29996/200000 [06:17<30:19, 93.45it/s]
-13.906113624572754
Time steps: 10000
---------------------------------------
Evaluation over 10 episodes: Return 3.122
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.80000
Unstable hours (%): 0.0
Weaning score: 0.3866666666666667
Super metric: 0.20000
---------------------------------------
-12.683723449707031
Time steps: 20000
---------------------------------------
Evaluation over 10 episodes: Return 2.547
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.90000
Unstable hours (%): 1.6666666666666665
Weaning score: 0.30000000000000004
Super metric: 0.00000
---------------------------------------
-19.809478759765625
Time steps: 30000
---------------------------------------
Evaluation over 10 episodes: Return -0.294
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.60000
Unstable hours (%): 8.333333333333332
Weaning score: 0.35833333333333334
Super metric: 0.00000
---------------------------------------
-42.71426773071289
Time steps: 40000
---------------------------------------
Evaluation over 10 episodes: Return 1.082
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.80000
Unstable hours (%): 3.333333333333333
Weaning score: 0.13999999999999999
Super metric: 0.40000
---------------------------------------
-70.02273559570312
Time steps: 50000
---------------------------------------
Evaluation over 10 episodes: Return 0.640
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.60000
Unstable hours (%): 3.333333333333333
Weaning score: 0.12000000000000002
Super metric: 0.10000
---------------------------------------
-93.7069091796875
Time steps: 60000
---------------------------------------
Evaluation over 10 episodes: Return -0.029
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.70000
Unstable hours (%): 1.6666666666666665
Weaning score: 0.15999999999999998
Super metric: 0.20000
---------------------------------------
-122.3208999633789
Time steps: 70000
---------------------------------------
Evaluation over 10 episodes: Return -0.806
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.50000
Unstable hours (%): 6.666666666666666
Weaning score: 0.06
Super metric: 0.20000
---------------------------------------
-151.5006103515625
Time steps: 80000
---------------------------------------
Evaluation over 10 episodes: Return -3.743
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.60000
Unstable hours (%): 15.0
Weaning score: 0.04
Super metric: 0.10000
---------------------------------------
-187.22215270996094
Time steps: 90000
---------------------------------------
Evaluation over 10 episodes: Return 0.576
ACP 0.3000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.60000
Unstable hours (%): 3.333333333333333
Weaning score: 0.17
Super metric: 0.50000
---------------------------------------
-226.8029022216797
Time steps: 100000
---------------------------------------
Evaluation over 10 episodes: Return 0.218
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.80000
Unstable hours (%): 6.666666666666666
Weaning score: 0.04
Super metric: 0.20000
---------------------------------------
-246.9803009033203
Time steps: 110000
---------------------------------------
Evaluation over 10 episodes: Return -2.922
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.50000
Unstable hours (%): 1.6666666666666665
Weaning score: 0.04
Super metric: 0.10000
---------------------------------------
-266.87060546875
Time steps: 120000
---------------------------------------
Evaluation over 10 episodes: Return 0.449
ACP 0.0000
MAP AIR/ep: 0.05000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.35000
Unstable hours (%): 21.666666666666664
Weaning score: 0.12
Super metric: 0.60000
---------------------------------------
-286.10906982421875
Time steps: 130000
---------------------------------------
Evaluation over 10 episodes: Return -0.379
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.50000
Unstable hours (%): 4.999999999999999
Weaning score: 0.06000000000000001
Super metric: 0.50000
---------------------------------------
-295.2613525390625
Time steps: 140000
---------------------------------------
Evaluation over 10 episodes: Return -0.090
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.60000
Unstable hours (%): 14.999999999999996
Weaning score: 0.12
Super metric: 0.40000
---------------------------------------
-320.4217529296875
Time steps: 150000
---------------------------------------
Evaluation over 10 episodes: Return 1.332
ACP 0.6000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.70000
Unstable hours (%): 0.0
Weaning score: 0.29000000000000004
Super metric: 1.40000
---------------------------------------
-320.52410888671875
Time steps: 160000
---------------------------------------
Evaluation over 10 episodes: Return 1.601
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.05000
Aggregate AIR/ep: 0.33333
Unstable hours (%): 8.333333333333332
Weaning score: 0.13
Super metric: 0.60000
---------------------------------------
-333.50689697265625
Time steps: 170000
---------------------------------------
Evaluation over 10 episodes: Return -0.718
ACP 0.0000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.90000
Unstable hours (%): 10.0
Weaning score: 0.04
Super metric: 0.00000
---------------------------------------
-336.942626953125
Time steps: 180000
---------------------------------------
Evaluation over 10 episodes: Return -0.491
ACP 0.4000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.80000
Unstable hours (%): 0.0
Weaning score: 0.16
Super metric: 0.80000
---------------------------------------
-329.54541015625
Time steps: 190000
---------------------------------------
Evaluation over 10 episodes: Return 0.920
ACP 0.5000
MAP AIR/ep: 0.00000 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00000
Aggregate AIR/ep: 0.90000
Unstable hours (%): 0.0
Weaning score: 0.08
Super metric: 0.60000
---------------------------------------
-327.7715148925781
Time steps: 200000
---------------------------------------
Evaluation over 100 episodes: Return 0.837
ACP 0.0400
MAP AIR/ep: 0.00700 | HR AIR/ep: 0.00000 | Pulsatility AIR/ep: 0.00750
Aggregate AIR/ep: 0.64450
Unstable hours (%): 3.6666666666666674
Weaning score: 0.1839999999999999
Super metric: 0.49000
---------------------------------------
Saved policy to /abiomed/models/policy_models/SVR_hpo/abiomed/2025-08-27_03-43-24/svr_seed_1_26_gamma1_0.2_gamma2_0.7_gamma3_1.0.pth
================================================================================
HYPERPARAMETER SEARCH RESULTS
================================================================================
Best Parameters: gamma1=0.2000, gamma2=0.5000, gamma3=1.0000
Best Score: 0.4465
Best Model Path: /abiomed/models/policy_models/SVR_hpo/abiomed/2025-08-27_03-43-24/svr_seed_1_23_gamma1_0.2_gamma2_0.5_gamma3_1.0.pth

Top 5 Results:
 trial_id  gamma1  gamma2  gamma3  custom_score  avg_reward   avg_ws  avg_acp  avg_air                                                                                                           model_path
       23    0.20     0.5     1.0      0.446519    0.935231 0.186500     0.06 0.610000 /abiomed/models/policy_models/SVR_hpo/abiomed/2025-08-27_03-43-24/svr_seed_1_23_gamma1_0.2_gamma2_0.5_gamma3_1.0.pth
       15    0.10     0.7     0.1      0.443115    0.974550 0.110833     0.06 0.647500 /abiomed/models/policy_models/SVR_hpo/abiomed/2025-08-27_03-43-24/svr_seed_1_15_gamma1_0.1_gamma2_0.7_gamma3_0.1.pth
        4    0.05     0.5     0.5      0.442682    1.004385 0.174333     0.19 0.635333 /abiomed/models/policy_models/SVR_hpo/abiomed/2025-08-27_03-43-24/svr_seed_1_4_gamma1_0.05_gamma2_0.5_gamma3_0.5.pth
       22    0.20     0.5     0.5      0.438896    0.847818 0.195167     0.00 0.630000 /abiomed/models/policy_models/SVR_hpo/abiomed/2025-08-27_03-43-24/svr_seed_1_22_gamma1_0.2_gamma2_0.5_gamma3_0.5.pth
       26    0.20     0.7     1.0      0.427278    0.837261 0.184000     0.04 0.644500 /abiomed/models/policy_models/SVR_hpo/abiomed/2025-08-27_03-43-24/svr_seed_1_26_gamma1_0.2_gamma2_0.7_gamma3_1.0.pth
